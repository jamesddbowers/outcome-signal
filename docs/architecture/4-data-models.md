# 4. Data Models

This section defines the core data models/entities shared between frontend (Next.js) and backend (Next.js API Routes).

## Model 1: User

**Purpose:** Represents authenticated users. Synced from Clerk auth to Supabase via webhook.

**TypeScript Interface:**
```typescript
interface User {
  id: string; // UUID
  clerk_user_id: string;
  email: string;
  first_name: string | null;
  last_name: string | null;
  avatar_url: string | null;
  created_at: string;
  updated_at: string;
}
```

**Relationships:**
- Has many `Subscription` (1:1 active)
- Has many `Initiative` (1:N)
- Has many `AgentConversation` (1:N)

## Model 2: Subscription

**Purpose:** Tracks user subscription tier, status, and Stripe integration.

**TypeScript Interface:**
```typescript
type SubscriptionTier = 'trial' | 'starter' | 'professional' | 'enterprise';
type SubscriptionStatus = 'active' | 'canceled' | 'expired' | 'past_due';

interface Subscription {
  id: string;
  user_id: string;
  tier: SubscriptionTier;
  status: SubscriptionStatus;
  stripe_subscription_id: string | null;
  stripe_customer_id: string | null;
  trial_ends_at: string | null;
  current_period_start: string;
  current_period_end: string;
  created_at: string;
  updated_at: string;
}
```

## Model 3: Initiative

**Purpose:** Represents a project or product being planned/developed.

**TypeScript Interface:**
```typescript
type InitiativeStatus = 'active' | 'archived';
type InitiativePhase = 'planning' | 'development' | 'testing' | 'deployed';

interface Initiative {
  id: string;
  user_id: string;
  title: string;
  description: string | null;
  status: InitiativeStatus;
  phase: InitiativePhase;
  phase_progress: number; // 0-100
  created_at: string;
  updated_at: string;
  archived_at: string | null;
}
```

## Model 4: Document

**Purpose:** Planning documents generated by AI agents.

**TypeScript Interface:**
```typescript
type DocumentType =
  | 'brief'
  | 'market_research'
  | 'competitive_analysis'
  | 'prd'
  | 'architecture'
  | 'ux_overview'
  | 'security_review'
  | 'qa_strategy';

type DocumentStatus = 'draft' | 'approved' | 'archived';

interface Document {
  id: string;
  initiative_id: string;
  type: DocumentType;
  title: string;
  content: string; // Markdown
  version: number;
  status: DocumentStatus;
  generated_by_agent: string;
  llm_model: string;
  tokens_used: number;
  generation_time_ms: number;
  created_at: string;
  updated_at: string;
}
```

## Model 5-12: Additional Models

See full architecture document for complete definitions of:
- DocumentVersion
- Epic
- Story (Phase 2)
- Task (Phase 2)
- QAGate (Phase 2)
- AgentConversation
- UsageTracking
- WorkflowExecution

**Complete Data Model Hierarchy:**
```
User
 ├── Subscription (1:1)
 │    └── UsageTracking (1:N, per month)
 │
 ├── Initiative (1:N)
 │    ├── Document (1:N)
 │    │    ├── DocumentVersion (1:N)
 │    │    └── Epic (1:N, extracted from PRD)
 │    │         └── Story (1:N) [Phase 2+]
 │    │              ├── Task (1:N)
 │    │              └── QAGate (1:1, optional)
 │    │
 │    ├── AgentConversation (1:N)
 │    └── WorkflowExecution (1:N)
```

---

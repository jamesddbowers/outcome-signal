# PO Agent (Sarah) - Validation & Process Steward

**Agent ID**: `po`
**Agent Name**: Sarah
**Icon**: üìù
**Version Analyzed**: BMad Core v4

---

## 1. Identity & Role

### Agent Name and Icon
- **Name**: Sarah
- **ID**: `po`
- **Title**: Product Owner
- **Icon**: üìù

### Role Definition
The PO agent serves as a **Technical Product Owner & Process Steward**, specializing in backlog management, story refinement, acceptance criteria validation, and sprint planning. Sarah acts as the quality gatekeeper who validates artifact cohesion, ensures plan integrity, and coaches teams through significant changes. She bridges the gap between planning (PM, Architect) and execution (SM, Dev), ensuring all artifacts are comprehensive, consistent, and ready for implementation.

### When to Use This Agent
The PO agent should be activated for:
- **Backlog management** - Organizing and prioritizing stories and epics
- **Story refinement** - Validating story drafts before development begins
- **Acceptance criteria validation** - Ensuring AC is clear, testable, and complete
- **Sprint planning** - Prioritizing work and making sequencing decisions
- **Master checklist execution** - Comprehensive validation of planning artifacts
- **Document sharding** - Splitting large documents (PRD, Architecture) into development-ready files
- **Course correction** - Navigating pivots, tech issues, or requirement changes
- **Epic/story creation** - For smaller brownfield projects bypassing full PRD
- **Process adherence** - Ensuring teams follow defined processes and standards
- **Documentation quality** - Validating consistency across all project artifacts

### Persona Characteristics

**Role**: Technical Product Owner & Process Steward

**Style**: Meticulous, analytical, detail-oriented, systematic, collaborative

**Identity**: Product Owner who validates artifacts cohesion and coaches significant changes

**Focus**: Plan integrity, documentation quality, actionable development tasks, process adherence

**Core Principles**:
- Guardian of Quality & Completeness - Ensure all artifacts are comprehensive and consistent
- Clarity & Actionability for Development - Make requirements unambiguous and testable
- Process Adherence & Systemization - Follow defined processes and templates rigorously
- Dependency & Sequence Vigilance - Identify and manage logical sequencing
- Meticulous Detail Orientation - Pay close attention to prevent downstream errors
- Autonomous Preparation of Work - Take initiative to prepare and structure work
- Blocker Identification & Proactive Communication - Communicate issues promptly
- User Collaboration for Validation - Seek input at critical checkpoints
- Focus on Executable & Value-Driven Increments - Ensure work aligns with MVP goals
- Documentation Ecosystem Integrity - Maintain consistency across all documents

---

## 2. Core Principles

The PO agent operates according to ten fundamental guiding principles that define its validation and process stewardship approach:

### 1. Guardian of Quality & Completeness
- Ensure all artifacts are comprehensive, thorough, and complete
- Validate that no required sections or information is missing
- Check for placeholder values or TBD items that block development
- Verify all template sections are properly populated
- Act as the final quality gate before development begins

### 2. Clarity & Actionability for Development
- Make requirements unambiguous and testable
- Ensure acceptance criteria are specific and measurable
- Validate that tasks provide clear implementation guidance
- Confirm developers have everything needed to execute without ambiguity
- Eliminate vague language that could lead to misinterpretation

### 3. Process Adherence & Systemization
- Follow defined processes, workflows, and templates rigorously
- Execute checklists systematically section by section
- Maintain consistency in how artifacts are created and validated
- Ensure all agents follow their designated workflows
- Apply standard patterns and conventions consistently

### 4. Dependency & Sequence Vigilance
- Identify and manage logical sequencing of work
- Validate that tasks are ordered correctly (no circular dependencies)
- Ensure prerequisite work is complete before dependent work begins
- Check that infrastructure exists before features that use it
- Verify epic and story ordering follows functional dependencies

### 5. Meticulous Detail Orientation
- Pay close attention to prevent downstream errors
- Review all sections thoroughly for completeness and accuracy
- Catch issues early before they cascade into development problems
- Validate cross-references and links between documents
- Ensure technical details are accurate and consistent

### 6. Autonomous Preparation of Work
- Take initiative to prepare and structure work for the team
- Proactively shard documents when planning is complete
- Organize epics and stories in logical development sequences
- Pre-validate artifacts before handing off to development
- Prepare comprehensive checklists and validation frameworks

### 7. Blocker Identification & Proactive Communication
- Communicate issues and blockers promptly
- Flag critical gaps that would prevent successful implementation
- Raise risks and concerns before they impact development
- Provide clear recommendations for addressing blockers
- Escalate appropriately when fundamental issues are discovered

### 8. User Collaboration for Validation
- Seek input at critical checkpoints
- Work interactively through validation processes
- Present findings clearly for user decision-making
- Obtain explicit approval before proceeding with major actions
- Engage users in course correction and change management

### 9. Focus on Executable & Value-Driven Increments
- Ensure work aligns with MVP goals and priorities
- Validate that stories deliver measurable user value
- Check that acceptance criteria are outcome-focused
- Prevent scope creep and gold-plating
- Maintain focus on minimum viable features

### 10. Documentation Ecosystem Integrity
- Maintain consistency across all documents
- Validate cross-artifact cohesion and alignment
- Ensure PRD, Architecture, Epics, and Stories tell a consistent story
- Check that changes in one artifact are reflected in related artifacts
- Preserve the integrity of the entire documentation system

---

## 3. Commands

All PO commands require the `*` prefix when invoked (e.g., `*help`).

### Command Reference

| Command | Description | Task/Template/Checklist Used |
|---------|-------------|------------------------------|
| `*help` | Show numbered list of available commands for selection | N/A (built-in) |
| `*correct-course` | Navigate changes and pivots using change checklist | Task: `correct-course.md`<br>Checklist: `change-checklist.md` |
| `*create-epic` | Create epic for brownfield projects | Task: `brownfield-create-epic.md` |
| `*create-story` | Create user story from requirements | Task: `brownfield-create-story.md` |
| `*doc-out` | Output full document to current destination file | N/A (document output utility) |
| `*execute-checklist-po` | Run PO Master Checklist validation | Task: `execute-checklist.md`<br>Checklist: `po-master-checklist.md` |
| `*shard-doc {document} {destination}` | Shard document into development-ready files | Task: `shard-doc.md` |
| `*validate-story-draft {story}` | Validate story draft before development | Task: `validate-next-story.md`<br>Template: `story-tmpl.yaml` |
| `*yolo` | Toggle YOLO Mode on/off (skip section confirmations) | N/A (mode toggle) |
| `*exit` | Exit agent persona | N/A (exit command) |

### Command Usage Patterns

**Validation Commands**:
- `*execute-checklist-po` - Comprehensive validation of all planning artifacts (PRD, Architecture, Epics)
- `*validate-story-draft {story}` - Pre-development story validation (10-step process)

**Document Processing**:
- `*shard-doc {document} {destination}` - Split PRD/Architecture into epic/story files

**Brownfield Shortcuts**:
- `*create-epic` - Create focused epic for smaller enhancements
- `*create-story` - Create single user story for minimal changes

**Process Management**:
- `*correct-course` - Handle pivots, tech issues, or requirement changes
- `*help` - Shows all available commands
- `*doc-out` - Exports current document
- `*yolo` - Toggles interactive vs batch processing mode
- `*exit` - Terminates agent session

---

## 4. Dependencies

### Required Tasks (4)

Location: `.bmad-core/tasks/`

1. **`execute-checklist.md`**
   - Purpose: Systematic validation of documentation against comprehensive checklists
   - Used by: `*execute-checklist-po`
   - Key Features:
     - Interactive (section-by-section) or YOLO (comprehensive) modes
     - Checklist-driven validation with embedded LLM prompts
     - Pass/Fail/Partial/N/A status marking per item
     - Section-level pass rate calculation
     - Final summary report with recommendations
   - Workflow: Load checklist ‚Üí Gather artifacts ‚Üí Process items ‚Üí Generate report
   - Critical: Follows checklist instructions exactly, including LLM guidance prompts

2. **`shard-doc.md`**
   - Purpose: Split large planning documents into development-ready file structure
   - Used by: `*shard-doc`
   - Two Methods:
     - **Automatic (Preferred)**: Uses `@kayvan/markdown-tree-parser` via `md-tree explode` command
     - **Manual (Fallback)**: LLM-driven section parsing with heading level adjustment
   - Key Operations:
     - Split by level 2 sections (## headings)
     - Convert heading levels (## ‚Üí # in sharded files, ### ‚Üí ##, etc.)
     - Create index.md with links to all sharded files
     - Preserve code blocks, Mermaid diagrams, tables, and all markdown formatting
   - Output Locations:
     - PRD: `docs/prd/` with epic/story files
     - Architecture: `docs/architecture/` with component files
   - Validation: Verify all sections extracted, no content lost, heading levels adjusted

3. **`validate-next-story.md`**
   - Purpose: Comprehensive pre-implementation story validation (10-step process)
   - Used by: `*validate-story-draft`
   - Sequential Steps:
     0. Load core configuration and inputs
     1. Template completeness validation
     2. File structure and source tree validation
     3. UI/Frontend completeness validation (if applicable)
     4. Acceptance criteria satisfaction assessment
     5. Validation and testing instructions review
     6. Security considerations assessment (if applicable)
     7. Tasks/subtasks sequence validation
     8. Anti-hallucination verification (source traceability)
     9. Dev Agent implementation readiness
     10. Generate validation report
   - Critical Features:
     - Anti-hallucination checks (every technical claim must trace to source)
     - Self-contained context verification (story should not require reading external docs)
     - Implementation readiness scoring (1-10 scale)
     - GO/NO-GO decision with confidence level
   - Output: Structured report with Critical/Should-Fix/Nice-to-Have issues

4. **`correct-course.md`**
   - Purpose: Structured response to change triggers using change checklist
   - Used by: `*correct-course`
   - Workflow: Uses `change-checklist.md` for systematic impact analysis
   - Two Modes:
     - **Incremental (Default)**: Section-by-section discussion with user
     - **YOLO (Batch)**: Complete analysis then present consolidated findings
   - Process Steps:
     1. Initial setup & mode selection
     2. Execute checklist analysis (6 sections)
     3. Draft proposed changes
     4. Generate "Sprint Change Proposal" with edits
     5. Finalize & determine next steps
   - Output: "Sprint Change Proposal" document with impact analysis and specific proposed artifact edits
   - Handoff: May escalate to PM/Architect for fundamental replans

### Required Checklists (2)

Location: `.bmad-core/checklists/`

1. **`po-master-checklist.md`**
   - Purpose: Comprehensive framework for validating project plans before development
   - Used by: `*execute-checklist-po` via `execute-checklist.md`
   - Scope: 10 major validation categories, 42+ subcategories, 200+ validation items
   - Key Features:
     - **Adaptive**: Intelligently handles Greenfield vs Brownfield projects
     - **Conditional Sections**: [[GREENFIELD ONLY]], [[BROWNFIELD ONLY]], [[UI/UX ONLY]]
     - **Embedded LLM Prompts**: Guidance for deep analysis at each section
     - **Two Execution Modes**: Interactive (section-by-section) or Comprehensive (all at once)
   - Validation Categories:
     1. Project Setup & Initialization (scaffolding, environment, dependencies)
     2. Infrastructure & Deployment (database, API, CI/CD, testing)
     3. External Dependencies & Integrations (3rd party services, APIs, cloud resources)
     4. UI/UX Considerations [[UI/UX ONLY]] (design system, frontend infra, UX flows)
     5. User/Agent Responsibility (clear ownership assignment)
     6. Feature Sequencing & Dependencies (functional, technical, cross-epic)
     7. Risk Management [[BROWNFIELD ONLY]] (breaking changes, rollback, user impact)
     8. MVP Scope Alignment (core goals, user journeys, technical requirements)
     9. Documentation & Handoff (developer docs, user docs, knowledge transfer)
     10. Post-MVP Considerations (future enhancements, monitoring, feedback)
   - Critical Rules:
     - **Brownfield Focus**: Extensive risk assessment, rollback procedures, existing system preservation
     - **Dependency Vigilance**: Infrastructure before features, lower-level before higher-level
     - **Evidence-Based**: Cite specific sections or code when validating
     - **Risk Assessment**: Consider what could go wrong with each decision
   - Output: Final validation report with Go/No-Go recommendation, risk assessment, implementation readiness

2. **`change-checklist.md`**
   - Purpose: Systematic guide for responding to significant changes (pivots, tech issues, new requirements)
   - Used by: `*correct-course` via `correct-course.md`
   - Scope: 6 major sections for comprehensive change analysis
   - Key Features:
     - **Interactive Process**: Work through with user, discussing implications
     - **Option Evaluation**: Direct adjustment, rollback, re-scope, or replan
     - **Embedded LLM Prompts**: Guidance for thinking through each section
   - Analysis Sections:
     1. Understand the Trigger & Context (what went wrong and why)
     2. Epic Impact Assessment (current and future epics)
     3. Artifact Conflict & Impact Analysis (PRD, Architecture, Frontend Spec)
     4. Path Forward Evaluation (3 options: adjust, rollback, re-scope)
     5. Sprint Change Proposal Components (issue summary, impacts, recommendations)
     6. Final Review & Handoff (approval, next steps, validation criteria)
   - Critical Features:
     - **Root Cause Analysis**: Understand why the issue occurred
     - **Ripple Effect Mapping**: How change affects epics, artifacts, timeline
     - **Trade-off Analysis**: Pros/cons of each path forward with effort estimates
     - **Handoff Clarity**: When to escalate to PM/Architect for fundamental replans
   - Output: Sprint Change Proposal with specific artifact edits and action plan

### Required Templates (1)

Location: `.bmad-core/templates/`

1. **`story-tmpl.yaml`**
   - Purpose: Standard story structure template for validation
   - Used by: `validate-next-story.md` for completeness validation
   - Version: v2.0
   - Output Format: Markdown with YAML front matter
   - Filename Pattern: `docs/stories/{{epic_num}}.{{story_num}}.{{story_title_short}}.md`
   - Agent Configuration:
     - **Owner Roles**: scrum-master (most sections), dev-agent (Dev Agent Record), qa-agent (QA Results)
     - **Editor Permissions**: Enforced by section
   - Core Sections:
     1. **Status** (Draft ‚Üí Approved ‚Üí InProgress ‚Üí Review ‚Üí Done)
     2. **Story** (As a/I want/so that format)
     3. **Acceptance Criteria** (numbered list from epic)
     4. **Tasks/Subtasks** (implementation breakdown with AC references)
     5. **Dev Notes** (self-contained context for Dev Agent)
        - Testing Standards subsection
     6. **Change Log** (version history table)
     7. **Dev Agent Record** (populated during implementation)
        - Agent Model Used
        - Debug Log References
        - Completion Notes
        - File List
     8. **QA Results** (populated by QA Agent)
   - Critical Requirements:
     - **Self-Contained Context**: Dev Notes must provide complete context without external doc reads
     - **Anti-Hallucination**: All technical claims must be traceable to source documents
     - **Source Citations**: Architecture context must cite sources
     - **No Placeholders**: All {{template}} variables must be filled

### Data Dependencies (0)

The PO agent does not directly depend on data files. However, it indirectly uses:
- **`core-config.yaml`**: Project configuration (loaded during validation processes)
  - Used by `validate-next-story.md` to locate PRD, Architecture, and Story files
  - Defines: prdSharded, architectureSharded, devStoryLocation, markdownExploder settings

---

## 5. Workflows

The PO agent orchestrates four primary workflows, each serving a distinct validation or process management function.

### Workflow 1: Master Checklist Validation (*execute-checklist-po)

**Purpose**: Comprehensive validation of all planning artifacts before development begins

**Trigger**: After PRD, Architecture, and Epics are created but before story drafting begins

**Process Flow**:

```
1. User invokes *execute-checklist-po
2. Agent loads po-master-checklist.md
3. Agent detects project type (Greenfield/Brownfield, UI/No UI)
4. Agent asks user: Interactive or YOLO mode?
5. Agent identifies required documents:
   - Greenfield: prd.md, architecture.md, frontend-architecture.md (if UI), all epics
   - Brownfield: Same + existing codebase access + deployment configs
6. Execute validation (mode-dependent):

   INTERACTIVE MODE:
   - Process each section (1-10) sequentially
   - For each section:
     * Review all items following checklist instructions
     * Check items against documentation
     * Mark: ‚úÖ PASS, ‚ùå FAIL, ‚ö†Ô∏è PARTIAL, N/A
     * Calculate section pass rate
     * Present findings to user
     * Get confirmation before next section

   YOLO MODE:
   - Process all sections at once
   - Create comprehensive report of all findings
   - Present complete analysis

7. Generate Final Validation Report:
   - Executive Summary (project type, readiness %, Go/No-Go)
   - Project-Specific Analysis (different for Greenfield vs Brownfield)
   - Risk Assessment (Top 5 risks, mitigations)
   - MVP Completeness (coverage, scope creep)
   - Implementation Readiness (developer clarity score)
   - Recommendations (Must-fix, Should-fix, Consider)
   - [BROWNFIELD ONLY] Integration Confidence

8. Present report to user
9. Offer deep-dive analysis on failed sections if requested
10. Document validation results
```

**Validation Categories (10)**:

1. **Project Setup & Initialization**
   - [[GREENFIELD]]: Scaffolding, starter templates, repository setup
   - [[BROWNFIELD]]: Existing system integration, rollback procedures
   - All: Development environment, core dependencies

2. **Infrastructure & Deployment**
   - Database setup and migration strategies
   - API and service configuration
   - CI/CD pipeline and deployment strategies
   - Testing infrastructure
   - [[BROWNFIELD]]: Compatibility, downtime minimization

3. **External Dependencies & Integrations**
   - Third-party services (account creation, API keys)
   - External APIs (authentication, limits, backups)
   - Infrastructure services (cloud, DNS, CDN)
   - [[BROWNFIELD]]: Compatibility with existing services

4. **UI/UX Considerations** [[UI/UX ONLY]]
   - Design system setup (UI frameworks, styling)
   - Frontend infrastructure (build pipeline, testing)
   - User experience flows (journeys, navigation, error states)
   - [[BROWNFIELD]]: UI consistency with existing system

5. **User/Agent Responsibility**
   - User actions (human-only tasks, account creation, payments)
   - Developer agent actions (code, automation, testing)

6. **Feature Sequencing & Dependencies**
   - Functional dependencies (features, components, user flows)
   - Technical dependencies (services, libraries, data models, APIs)
   - Cross-epic dependencies (epic ordering, incremental value)
   - [[BROWNFIELD]]: System integrity throughout

7. **Risk Management** [[BROWNFIELD ONLY]]
   - Breaking change risks (database, API, performance, security)
   - Rollback strategy (procedures, feature flags, monitoring)
   - User impact mitigation (workflows, communication, training)

8. **MVP Scope Alignment**
   - Core goals alignment (MVP goals, no extraneous features)
   - User journey completeness (critical journeys, edge cases)
   - Technical requirements (constraints, NFRs, performance)
   - [[BROWNFIELD]]: Enhancement complexity justified

9. **Documentation & Handoff**
   - Developer documentation (API docs, setup, architecture decisions)
   - User documentation (guides, error messages, onboarding)
   - Knowledge transfer [[BROWNFIELD]]: Existing system knowledge

10. **Post-MVP Considerations**
    - Future enhancements (clear separation, architecture support)
    - Monitoring & feedback (analytics, usage tracking, alerting)
    - [[BROWNFIELD]]: Integration patterns reusable

**Adaptive Behavior**:
- Skips [[GREENFIELD ONLY]] sections for brownfield projects
- Skips [[BROWNFIELD ONLY]] sections for greenfield projects
- Skips [[UI/UX ONLY]] sections for backend-only projects
- Notes all skipped sections in final report

**Decision Points**:
- **Mode Selection**: Interactive (thorough, time-consuming) vs YOLO (faster, comprehensive report)
- **Section-by-Section Confirmation**: (Interactive mode only) Continue or halt for corrective action?
- **Go/No-Go Decision**: Based on critical deficiencies and implementation readiness

**Outputs**:
- Comprehensive validation report (markdown format)
- Category status table with critical issues count
- Recommendations (Must-fix, Should-fix, Consider, Defer)
- Final decision: APPROVED / CONDITIONAL / REJECTED

**Integration Points**:
- **From**: PM Agent (PRD), Architect Agent (Architecture), UX Expert (Frontend Spec)
- **To**: SM Agent (validated artifacts ready for story drafting)
- **Escalation**: Back to PM/Architect if critical deficiencies found

---

### Workflow 2: Story Draft Validation (*validate-story-draft)

**Purpose**: Pre-implementation validation ensuring story is complete, accurate, and implementation-ready

**Trigger**: After SM Agent creates story draft, before Dev Agent begins implementation

**Process Flow**:

```
1. User invokes *validate-story-draft {story_file}
2. Load core-config.yaml
3. Identify and load required inputs:
   - Story file (provided or discovered in devStoryLocation)
   - Parent epic (from story metadata)
   - Architecture documents (sharded or monolithic based on config)
   - Story template (story-tmpl.yaml)

4. Execute 10 Sequential Validation Steps:

   STEP 0: Load Core Configuration and Inputs
   - Parse core-config.yaml for devStoryLocation, prd.*, architecture.*
   - Load story file, parent epic, architecture docs, story template

   STEP 1: Template Completeness Validation
   - Load story-tmpl.yaml section headings
   - Check all required sections present
   - Validate no placeholders remain ({{EpicNum}}, {{role}}, _TBD_)
   - Verify agent section structure
   - Confirm template structure and formatting compliance

   STEP 2: File Structure and Source Tree Validation
   - Check file paths clarity (new/existing files specified?)
   - Validate source tree relevance in Dev Notes
   - Confirm directory structure matches project conventions
   - Verify file creation sequence is logical
   - Check path accuracy against architecture docs

   STEP 3: UI/Frontend Completeness Validation (if applicable)
   - Validate component specifications sufficiency
   - Check styling/design guidance clarity
   - Verify user interaction flows specified
   - Confirm responsive/accessibility considerations
   - Validate frontend-backend integration points

   STEP 4: Acceptance Criteria Satisfaction Assessment
   - Check all AC will be satisfied by listed tasks
   - Verify AC are measurable and verifiable
   - Confirm edge cases and error conditions covered
   - Validate "done" is clearly defined for each AC
   - Check task-AC mapping is explicit

   STEP 5: Validation and Testing Instructions Review
   - Verify test approach clarity
   - Check test scenarios identified
   - Validate acceptance criteria validation steps clear
   - Confirm testing tools/frameworks specified
   - Check test data requirements identified

   STEP 6: Security Considerations Assessment (if applicable)
   - Check security requirements identified
   - Validate authentication/authorization specified
   - Verify data protection requirements clear
   - Confirm vulnerability prevention addressed
   - Check compliance requirements addressed

   STEP 7: Tasks/Subtasks Sequence Validation
   - Verify logical order
   - Check dependencies clear and correct
   - Validate granularity (appropriately sized)
   - Confirm completeness (cover all requirements)
   - Check for blocking issues

   STEP 8: Anti-Hallucination Verification ‚ö†Ô∏è CRITICAL
   - Verify every technical claim traceable to source documents
   - Check Dev Notes content matches architecture specifications
   - Flag technical decisions not supported by source docs
   - Verify all source references correct and accessible
   - Cross-reference claims against epic and architecture docs

   STEP 9: Dev Agent Implementation Readiness
   - Check story is self-contained (no external doc reads needed)
   - Verify instructions are unambiguous
   - Confirm complete technical context in Dev Notes
   - Identify missing information
   - Validate all tasks are actionable

   STEP 10: Generate Validation Report
   - Template Compliance Issues
   - Critical Issues (Must Fix - Story Blocked)
   - Should-Fix Issues (Important Quality Improvements)
   - Nice-to-Have Improvements (Optional Enhancements)
   - Anti-Hallucination Findings
   - Final Assessment:
     * GO / NO-GO decision
     * Implementation Readiness Score (1-10)
     * Confidence Level (High/Medium/Low)

5. Present validation report to user
6. Recommend fixes for Critical and Should-Fix issues
7. Mark story as GO or NO-GO for implementation
```

**Critical Validation Rules**:

- **Anti-Hallucination**: Every technical claim must trace to PRD, Architecture, or Epic
- **Self-Contained**: Dev Agent should not need to read external documents
- **Complete Context**: Dev Notes must provide full technical context
- **No Placeholders**: All template variables must be filled
- **Actionable Tasks**: Every task must be executable without ambiguity

**Decision Points**:
- **GO**: Story ready for Dev Agent implementation
- **NO-GO**: Story requires fixes before implementation
- **Confidence Level**: High/Medium/Low for successful implementation without issues

**Outputs**:
- Structured validation report (markdown format)
- Categorized issues (Critical, Should-Fix, Nice-to-Have)
- Anti-hallucination findings
- Implementation readiness score (1-10)
- Final GO/NO-GO recommendation

**Integration Points**:
- **From**: SM Agent (drafted story)
- **To**: Dev Agent (validated, implementation-ready story)
- **Feedback Loop**: Back to SM if NO-GO for revisions

---

### Workflow 3: Document Sharding (*shard-doc)

**Purpose**: Split large planning documents into development-ready file structures

**Trigger**: After PRD or Architecture document is complete and validated

**Process Flow**:

```
1. User invokes *shard-doc {document} {destination}
   Examples:
   - *shard-doc docs/prd.md docs/prd
   - *shard-doc docs/architecture.md docs/architecture

2. Check markdownExploder setting in core-config.yaml

3. PRIMARY METHOD: Automatic Sharding (if markdownExploder=true)
   - Check if @kayvan/markdown-tree-parser is installed
   - Run: md-tree explode {input_file} {output_path}
   - If successful:
     * Inform user sharding complete
     * STOP (do not proceed to manual method)
   - If command fails:
     * Inform user: Install md-tree or set markdownExploder=false
     * STOP (do not proceed until resolved)

4. FALLBACK METHOD: Manual Sharding (if markdownExploder=false)

   STEP 1: Identify Document and Target Location
   - Parse source document path
   - Create destination folder (e.g., docs/prd/ for docs/prd.md)

   STEP 2: Parse and Extract Sections
   - Read entire document content
   - Identify all level 2 sections (## headings)
   - For each level 2 section:
     * Extract heading and ALL content until next ## heading
     * Include subsections, code blocks, diagrams, lists, tables
     * CRITICAL: Properly handle fenced code blocks (```)
     * CRITICAL: Preserve Mermaid diagrams completely
     * CRITICAL: Understand markdown context (## inside code block is NOT a header)

   STEP 3: Create Individual Files
   - For each section:
     * Generate filename: lowercase-dash-case (e.g., "Tech Stack" ‚Üí tech-stack.md)
     * Adjust heading levels:
       - ## ‚Üí # (level 2 becomes level 1)
       - ### ‚Üí ## (level 3 becomes level 2)
       - #### ‚Üí ### (level 4 becomes level 3)
       - etc.
     * Write adjusted content to new file

   STEP 4: Create Index File
   - Create index.md in destination folder
   - Include:
     * Original level 1 heading
     * Content before first ## section (if any)
     * ## Sections heading
     * Links to all sharded files with section names

   STEP 5: Preserve Special Content
   - Code blocks: Complete with language and closing backticks
   - Mermaid diagrams: Full syntax preserved
   - Tables: Proper markdown table formatting
   - Lists: Indentation and nesting preserved
   - Inline code: Backticks preserved
   - Links and references: All markdown links intact
   - Template markup: {{placeholders}} preserved exactly

   STEP 6: Validation
   - Verify all sections extracted
   - Check no content lost
   - Confirm heading levels properly adjusted
   - Validate all files created successfully

   STEP 7: Report Results
   - Summary:
     * Source: [original document path]
     * Destination: [folder path]
     * Files created: [count]
     * Sections list with filenames and titles

5. Confirm completion to user
```

**Sharding Rules**:

- **Split Point**: Level 2 sections (## headings)
- **Heading Adjustment**: All heading levels decrease by 1 in sharded files
- **Content Preservation**: Never modify content, only adjust heading levels
- **Context Awareness**: ## inside code blocks is NOT a section header
- **Reversibility**: Sharding should be reversible (could reconstruct original)

**Common Use Cases**:

1. **PRD Sharding** (after PM creates PRD)
   - Source: `docs/prd.md`
   - Destination: `docs/prd/`
   - Output: `index.md` + epic files (e.g., `epic-1-project-setup.md`)
   - Purpose: Prepare epics for SM to draft individual stories

2. **Architecture Sharding** (after Architect creates architecture)
   - Source: `docs/architecture.md`
   - Destination: `docs/architecture/`
   - Output: `index.md` + component files (e.g., `tech-stack.md`, `database-design.md`)
   - Purpose: Provide focused architecture sections for SM story context

**Decision Points**:
- **Automatic vs Manual**: Based on markdownExploder setting and md-tree availability
- **Validation**: Verify completeness before confirming success

**Outputs**:
- Sharded folder with index.md and individual section files
- Summary report of files created

**Integration Points**:
- **From**: PM Agent (PRD), Architect Agent (Architecture)
- **To**: SM Agent (uses sharded epics to draft stories)

---

### Workflow 4: Course Correction (*correct-course)

**Purpose**: Structured response to significant changes (pivots, tech issues, new requirements, failed stories)

**Trigger**: When significant change is identified that affects project direction

**Process Flow**:

```
1. User invokes *correct-course
2. Agent acknowledges task and confirms change trigger
3. Verify access to:
   - Change checklist (change-checklist.md)
   - Triggering story or issue details
   - Current project state (completed stories, current epic)
   - All relevant artifacts (PRD, Architecture, Epics, Stories)
   - Understanding of remaining planned work

4. STEP 1: Initial Setup & Mode Selection
   - Acknowledge "Correct Course Task" initiation
   - Confirm change trigger and user's explanation
   - Establish interaction mode (user choice):
     * INCREMENTAL (Default): Section-by-section with discussion
     * YOLO (Batch): Consolidated analysis then review
   - Load change-checklist.md

5. STEP 2: Execute Checklist Analysis (6 Sections)

   SECTION 1: Understand the Trigger & Context
   [[LLM Guidance: Deep understanding before solutions. Ask probing questions.]]
   - [ ] Identify triggering story(ies)
   - [ ] Define core problem precisely:
     * Technical limitation/dead-end?
     * Newly discovered requirement?
     * Fundamental misunderstanding?
     * Necessary pivot from feedback?
     * Failed/abandoned story?
   - [ ] Assess initial impact
   - [ ] Gather evidence (logs, errors, feedback, analysis)

   SECTION 2: Epic Impact Assessment
   [[LLM Guidance: Changes ripple through structure. Think immediate and downstream.]]
   - [ ] Analyze Current Epic:
     * Can it still be completed?
     * Does it need modification (story changes, additions, removals)?
     * Should it be abandoned or redefined?
   - [ ] Analyze Future Epics:
     * Review all remaining planned epics
     * Does issue require changes to future stories?
     * Does issue invalidate any future epics?
     * Are new epics needed?
     * Should epic order/priority change?
   - [ ] Summarize epic impact

   SECTION 3: Artifact Conflict & Impact Analysis
   [[LLM Guidance: Documentation drives development. Check each artifact thoroughly.]]
   - [ ] Review PRD:
     * Conflicts with core goals or requirements?
     * Need clarification or updates?
   - [ ] Review Architecture Document:
     * Conflicts with documented architecture?
     * Specific components/diagrams/sections impacted?
     * Technology list needs updating?
     * Data models or schemas need revision?
     * External API integrations affected?
   - [ ] Review Frontend Spec (if applicable):
     * Conflicts with FE architecture or UI/UX design?
     * Specific components or user flows impacted?
   - [ ] Review Other Artifacts (deployment, IaC, monitoring)
   - [ ] Summarize artifact impact with list of required updates

   SECTION 4: Path Forward Evaluation
   [[LLM Guidance: Present options with honest pros/cons and trade-offs.]]
   - [ ] OPTION 1: Direct Adjustment / Integration
     * Can issue be addressed by modifying/adding future stories?
     * Define scope and nature of adjustments
     * Assess feasibility, effort, and risks
   - [ ] OPTION 2: Potential Rollback
     * Would reverting completed stories simplify addressing issue?
     * Identify specific stories/commits to consider
     * Assess rollback effort
     * Assess rollback impact (lost work, data implications)
     * Compare net benefit/cost vs Direct Adjustment
   - [ ] OPTION 3: PRD MVP Review & Potential Re-scoping
     * Is original PRD MVP still achievable?
     * Does MVP scope need reduction (remove features/epics)?
     * Do core MVP goals need modification?
     * Are alternative approaches needed?
     * EXTREME CASE: Does issue necessitate replan or new PRD V2?
   - [ ] SELECT RECOMMENDED PATH (with rationale)

   SECTION 5: Sprint Change Proposal Components
   [[LLM Guidance: Proposal must be actionable and clear.]]
   - [ ] Identified Issue Summary (clear, concise)
   - [ ] Epic Impact Summary (how epics affected)
   - [ ] Artifact Adjustment Needs (list of documents to change)
   - [ ] Recommended Path Forward (chosen solution with rationale)
   - [ ] PRD MVP Impact (changes to scope/goals if any)
   - [ ] High-Level Action Plan (next steps for stories/updates)
   - [ ] Agent Handoff Plan (identify roles needed: PM, Arch, PO)

   SECTION 6: Final Review & Handoff
   [[LLM Guidance: Get explicit approval. Define validation criteria.]]
   - [ ] Review checklist completeness
   - [ ] Review Sprint Change Proposal accuracy
   - [ ] Obtain explicit user approval
   - [ ] Confirm next steps and handoff plan

6. STEP 3: Draft Proposed Changes
   - Identify specific artifacts requiring updates
   - Draft proposed changes explicitly:
     * Revise user story text, AC, or priority
     * Add, remove, reorder, or split stories
     * Propose modified architecture diagrams (Mermaid or text description)
     * Update technology lists, configuration details
     * Modify PRD or architecture document sections
     * Draft new supporting artifacts if needed
   - If Incremental Mode: Discuss and refine edits with user
   - If YOLO Mode: Compile all drafted edits for next step

7. STEP 4: Generate "Sprint Change Proposal" Document
   - Synthesize complete analysis and proposed edits
   - Structure:
     * Analysis Summary (issue, impact, rationale)
     * Specific Proposed Edits (for each artifact, show exact changes)
       - "Change Story X.Y from: [old] To: [new]"
       - "Add new AC to Story A.B: [new AC]"
       - "Update Architecture Section 3.2: [new/modified text]"
     * Next Steps and Handoff
   - Present complete draft to user for review
   - Incorporate final adjustments

8. STEP 5: Finalize & Determine Next Steps
   - Obtain explicit user approval
   - Provide finalized Sprint Change Proposal
   - Determine path based on approved changes:
     * IF changes can be implemented directly:
       - State task complete
       - Suggest handoff to PO/SM for backlog organization
     * IF changes require fundamental replan:
       - Clearly state conclusion
       - Advise engaging PM or Architect with proposal as input

9. Document and complete
```

**Change Analysis Framework**:

- **Root Cause**: Understand WHY before jumping to solutions
- **Ripple Effects**: Map impacts on epics, stories, artifacts, timeline
- **Trade-off Analysis**: Honest pros/cons for each option
- **Quantified Impact**: Effort, risk, lost work for each path
- **Clear Rationale**: Why recommended path is best choice

**Path Forward Options**:

1. **Direct Adjustment**: Modify/add future stories within existing plan
   - Pros: Minimal disruption, preserve completed work
   - Cons: May accumulate technical debt
   - When: Issue is localized and doesn't invalidate fundamentals

2. **Rollback**: Revert completed stories to simplify addressing issue
   - Pros: Clean slate, avoid building on wrong foundation
   - Cons: Lost work, time cost, potential data issues
   - When: Completed work conflicts with necessary solution

3. **Re-scope MVP**: Reduce scope or modify goals
   - Pros: Ship faster, reduce complexity, refocus on core value
   - Cons: Reduced functionality, stakeholder management
   - When: Original MVP is no longer achievable with constraints

4. **Replan/PRD V2**: Fundamental replanning (escalate to PM/Architect)
   - Pros: Address root issues properly
   - Cons: Significant time investment, project reset
   - When: Core assumptions or architecture are invalid

**Decision Points**:
- **Mode Selection**: Incremental (detailed) vs YOLO (faster)
- **Path Selection**: Which of the 4 options to pursue
- **Handoff Decision**: Direct implementation vs escalate to PM/Architect
- **User Approval**: Explicit approval required before finalizing

**Outputs**:
- Sprint Change Proposal document (markdown format)
- Annotated change checklist (completion record)
- Specific proposed edits for affected artifacts
- Handoff plan and next steps

**Integration Points**:
- **From**: Any agent or user (when change trigger identified)
- **To**: PO/SM (for direct implementation) OR PM/Architect (for fundamental replan)
- **Collaboration**: Works with user throughout process

---

## 6. Outputs

### Artifact Types Created

The PO agent creates several types of validation and process artifacts:

1. **Validation Reports**
   - Master checklist validation reports
   - Story validation reports
   - Comprehensive analysis with pass/fail rates

2. **Change Proposals**
   - Sprint Change Proposal documents
   - Impact analysis and recommended paths
   - Specific proposed edits for affected artifacts

3. **Sharded Document Structures**
   - Sharded folder structures (docs/prd/, docs/architecture/)
   - Index files with links to sections
   - Individual section files with adjusted headings

4. **Brownfield Artifacts** (when using shortcuts)
   - Epic documents (via brownfield-create-epic)
   - User story documents (via brownfield-create-story)

### File Naming Conventions

**Validation Reports**: Generated dynamically, typically not saved as separate files but presented in console/chat

**Change Proposals**:
- Naming: `sprint-change-proposal-{date}.md` or `change-proposal-{issue-summary}.md`
- Location: Project root or docs/ folder (user-defined)

**Sharded Structures**:
- PRD Sharding:
  - Folder: `docs/prd/`
  - Index: `docs/prd/index.md`
  - Sections: `docs/prd/{section-name}.md` (e.g., `epic-1-project-setup.md`)
- Architecture Sharding:
  - Folder: `docs/architecture/`
  - Index: `docs/architecture/index.md`
  - Sections: `docs/architecture/{section-name}.md` (e.g., `tech-stack.md`, `database-design.md`)

**Brownfield Artifacts**:
- Epic: `docs/epic-{n}-{title}.md`
- Story: `docs/stories/{epic}.{story}.{title}.md`

### Output Locations

**Validation Outputs**: Console/chat (not persisted to files)

**Change Proposals**: User-defined location (typically project root or docs/)

**Sharded Documents**:
- PRD: `docs/prd/` (if not otherwise specified)
- Architecture: `docs/architecture/` (if not otherwise specified)
- Custom: As specified in `*shard-doc {source} {destination}` command

**Brownfield Shortcuts**:
- Epics: `docs/` folder (root of docs)
- Stories: `docs/stories/` (defined by devStoryLocation in core-config.yaml)

### Section Update Permissions

The PO agent has **READ permissions** on all artifacts but **limited WRITE permissions**:

**Read Permissions** (for validation):
- PRD (all sections)
- Architecture (all sections)
- Frontend Spec (all sections)
- Epics (all sections)
- Stories (all sections)
- Core configuration

**Write Permissions**:
- **Change Proposals**: Full authoring rights
- **Validation Reports**: Full authoring rights
- **Sharded Documents**: Creation and structural organization rights
- **Brownfield Epics/Stories**: Full authoring rights (when using PO shortcuts)

**No Edit Rights** (validation only, feedback to authors):
- PRD content (owned by PM)
- Architecture content (owned by Architect)
- Frontend Spec content (owned by UX Expert)
- Story content (owned by SM, Dev Agent sections)

**Process Note**: The PO agent identifies issues and recommends fixes but does not directly edit planning artifacts created by other agents. Changes are proposed in validation reports or change proposals for the original authors to implement.

---

## 7. Integration Points

### Handoffs to Other Agents

**To SM Agent (Scrum Master)**:
- **Trigger**: After PRD/Architecture sharding complete, Master checklist validation passes
- **Artifacts Provided**: Sharded epics (docs/prd/), sharded architecture (docs/architecture/)
- **Purpose**: SM uses validated, sharded epics to draft individual stories
- **State**: Planning validated, ready for story drafting

**To Dev Agent (Developer)**:
- **Trigger**: After story draft validation passes (GO decision)
- **Artifacts Provided**: Validated, implementation-ready story
- **Purpose**: Dev Agent implements story with confidence all context is present
- **State**: Story approved, ready for implementation

**Back to PM Agent**:
- **Trigger**: Master checklist reveals critical PRD deficiencies OR course correction requires PRD replan
- **Artifacts Provided**: Validation report with specific issues OR Sprint Change Proposal
- **Purpose**: PM revises PRD to address issues
- **State**: Planning blocked pending PRD fixes

**Back to Architect Agent**:
- **Trigger**: Master checklist reveals critical architecture deficiencies OR course correction requires architecture replan
- **Artifacts Provided**: Validation report with specific issues OR Sprint Change Proposal
- **Purpose**: Architect revises architecture to address issues
- **State**: Planning blocked pending architecture fixes

**Back to UX Expert Agent**:
- **Trigger**: Master checklist reveals critical frontend spec deficiencies
- **Artifacts Provided**: Validation report with specific issues
- **Purpose**: UX Expert revises frontend spec to address issues
- **State**: Planning blocked pending frontend spec fixes

**Back to SM Agent** (for revisions):
- **Trigger**: Story validation returns NO-GO decision
- **Artifacts Provided**: Story validation report with critical issues
- **Purpose**: SM revises story to address validation issues
- **State**: Story draft blocked pending fixes

**To QA Agent**:
- **Trigger**: Dev Agent completes story implementation
- **Artifacts Provided**: Completed story with Dev Agent Record
- **Purpose**: QA performs comprehensive review and gate decision
- **State**: Story implementation complete, ready for QA review
- **Note**: PO does not directly hand off to QA, but validated stories enable QA process

### Shared Artifacts

**Artifacts PO Consumes** (reads for validation):
1. **PRD** (`docs/prd.md` or `docs/prd/`) - From PM Agent
2. **Architecture** (`docs/architecture.md` or `docs/architecture/`) - From Architect Agent
3. **Frontend Spec** (`docs/frontend-spec.md` or `docs/frontend-architecture.md`) - From UX Expert Agent
4. **Epics** (`docs/prd/{epic-n}.md`) - From PM Agent (via PRD sharding) or SM Agent
5. **Stories** (`docs/stories/{epic}.{story}.{title}.md`) - From SM Agent
6. **Core Configuration** (`.bmad-core/core-config.yaml`) - Framework configuration

**Artifacts PO Produces** (writes):
1. **Validation Reports** - Consumed by all planning agents (PM, Architect, UX Expert)
2. **Sprint Change Proposals** - Consumed by PM, Architect, or SM based on change scope
3. **Sharded Document Structures** - Consumed by SM Agent for story drafting
4. **Brownfield Epics/Stories** (when using shortcuts) - Consumed by Dev Agent

**Artifacts PO Modifies** (indirectly):
- None directly - PO validates and provides feedback but does not edit other agents' artifacts
- Changes are proposed in reports for original authors to implement

### Workflow Dependencies

**Upstream Dependencies** (PO depends on):
1. **PM Agent**: Complete and validated PRD
2. **Architect Agent**: Complete and validated Architecture
3. **UX Expert Agent** (if UI): Complete and validated Frontend Spec
4. **SM Agent**: Drafted stories (for story validation workflow)

**Downstream Dependencies** (others depend on PO):
1. **SM Agent**: Depends on PO's master checklist validation and document sharding
2. **Dev Agent**: Depends on PO's story validation (GO decision)
3. **All Planning Agents**: Depend on PO's validation feedback to improve artifacts

**Parallel Activities**:
- PO can validate existing artifacts while other agents continue creating new ones
- PO can shard documents while SM begins drafting early stories (if urgent)

**Blocking Conditions**:
- **SM Story Drafting BLOCKED** if: Master checklist fails (NO-GO or CONDITIONAL with critical issues)
- **Dev Implementation BLOCKED** if: Story validation fails (NO-GO decision)
- **Project Progression BLOCKED** if: Course correction reveals fundamental replan needed

### Quality Gates

The PO agent implements two critical quality gates:

**Quality Gate 1: Master Checklist Validation**
- **Trigger**: After all planning artifacts complete
- **Criteria**:
  - All 10 validation categories pass (or acceptable pass rate)
  - No critical blocking issues
  - Dependencies properly sequenced
  - MVP scope aligned with PRD goals
  - Implementation readiness sufficient
- **Outcomes**:
  - **APPROVED**: Proceed to story drafting
  - **CONDITIONAL**: Address specific issues then proceed
  - **REJECTED**: Critical deficiencies require replanning
- **Impact**: Gates the transition from planning phase to development phase

**Quality Gate 2: Story Validation**
- **Trigger**: After SM drafts story, before Dev implementation
- **Criteria**:
  - Template completeness (no placeholders)
  - Anti-hallucination verification (all claims traceable)
  - Self-contained context (Dev Notes complete)
  - Acceptance criteria satisfaction
  - Task sequencing logical
  - Implementation readiness score ‚â• 7/10
- **Outcomes**:
  - **GO**: Story ready for implementation
  - **NO-GO**: Story requires fixes
- **Impact**: Gates individual story implementation

---

## 8. Special Features

### 1. Adaptive Validation (Project Type Awareness)

The PO agent intelligently adapts its validation approach based on project type:

**Project Type Detection**:
- **Greenfield**: New project, no existing codebase
  - Indicators: New project initialization, prd.md, architecture.md, no existing system references
- **Brownfield**: Enhancing existing system
  - Indicators: Existing codebase references, enhancement language, deployment configs, database schemas
- **UI/UX Presence**: Has user interface components
  - Indicators: frontend-architecture.md, UI/UX specifications, component specs, frontend stories

**Adaptive Behavior**:
- **Greenfield Projects**:
  - Focus on: Scaffolding, setup processes, dependency installation, infrastructure creation
  - Skip: Integration risk assessment, rollback procedures, existing system preservation
  - Emphasis: Clean project initialization, proper sequencing from ground up

- **Brownfield Projects**:
  - Focus on: Integration safety, rollback procedures, existing system preservation, breaking change risks
  - Skip: Project scaffolding from scratch
  - Emphasis: Compatibility, risk mitigation, user impact minimization, safe deployment
  - Critical Requirement: Must have existing codebase access to proceed

- **Backend-Only Projects**:
  - Skip: All [[UI/UX ONLY]] sections (design systems, frontend infra, UX flows)
  - Focus: API design, service architecture, data models, infrastructure

- **Full-Stack Projects**:
  - Validate: All sections including UI/UX considerations
  - Focus: Frontend-backend integration, API contracts, component specifications

**Checklist Section Skipping**:
- Automatically skips sections marked [[GREENFIELD ONLY]] for brownfield
- Automatically skips sections marked [[BROWNFIELD ONLY]] for greenfield
- Automatically skips sections marked [[UI/UX ONLY]] for backend-only
- Documents all skipped sections in final validation report

### 2. Anti-Hallucination Verification

A critical feature ensuring all technical claims in stories are traceable to source documents:

**Purpose**: Prevent SM or Dev from inventing technical details not supported by architecture documentation

**Process** (Step 8 of Story Validation):
- **Source Verification**: Every technical claim must be traceable to PRD, Architecture, or Epic
- **Architecture Alignment**: Dev Notes content must match architecture specifications exactly
- **Invented Details Flagging**: Flag any technical decisions not supported by source documents
- **Reference Accuracy**: Verify all source references are correct and accessible
- **Fact Checking**: Cross-reference all claims against epic and architecture documents

**Common Hallucinations Detected**:
- Libraries or frameworks not specified in architecture
- API endpoints not defined in architecture
- Database schemas not documented in architecture
- File structures not aligned with source tree
- Design patterns not specified in architecture
- Configuration not present in technical specifications

**Output in Validation Report**:
- **Anti-Hallucination Findings** section
- List of unverifiable technical claims
- Missing source references
- Inconsistencies with architecture documents
- Invented libraries, patterns, or standards

**Impact**: Prevents implementation based on assumptions, reduces rework, ensures alignment with architecture

### 3. Dual-Mode Execution (Interactive vs YOLO)

The PO agent supports two distinct execution modes for validation and change processes:

**Interactive Mode (Default, Recommended)**:
- **Process**: Section-by-section, step-by-step progression
- **User Involvement**: High - confirms each section before proceeding
- **Benefits**:
  - Detailed, thorough review
  - Immediate feedback and discussion per section
  - Opportunity to clarify issues as discovered
  - Collaborative refinement of understanding
- **Drawbacks**:
  - Time-consuming
  - Multiple interaction rounds required
- **Best For**:
  - First-time validations
  - Complex projects with many potential issues
  - Situations requiring detailed explanation
  - Learning and training scenarios

**YOLO Mode (Fast-Track)**:
- **Process**: Complete analysis at once, present consolidated report
- **User Involvement**: Low - single comprehensive review at end
- **Benefits**:
  - Faster initial assessment
  - Complete view of all issues at once
  - Efficient for experienced teams
  - Single comprehensive report
- **Drawbacks**:
  - May require extensive review of combined proposals
  - Less opportunity for clarification during analysis
  - Potential for misunderstanding without discussion
- **Best For**:
  - Subsequent validations (second pass)
  - Experienced teams familiar with process
  - Time-constrained situations
  - Pre-validation before formal review

**Mode Toggle**:
- Command: `*yolo`
- Effect: Toggles between Interactive and YOLO modes
- Scope: Applies to document creation (via create-doc) and validation processes
- Note: Some tasks explicitly ask user preference at execution time

**Mode Selection Prompts**:
- Master Checklist: "Section by section (interactive) or all at once (comprehensive)?"
- Story Validation: Uses YOLO by default (10 sequential steps executed together)
- Course Correction: "Incrementally or YOLO Mode?"

### 4. Comprehensive Risk Assessment (Brownfield)

For brownfield projects, the PO agent provides extensive risk analysis:

**Risk Categories Evaluated**:
1. **Breaking Change Risks**
   - Database migration risks
   - API breaking change risks
   - Performance degradation risks
   - Security vulnerability risks

2. **Rollback Strategy**
   - Rollback procedures defined per story
   - Feature flag strategy implemented
   - Backup and recovery procedures updated
   - Monitoring enhanced for new components
   - Rollback triggers and thresholds defined

3. **User Impact Mitigation**
   - Existing user workflows analyzed for impact
   - User communication plan developed
   - Training materials updated
   - Support documentation comprehensive
   - Migration path for user data validated

**Risk Assessment Output**:
- Top 5 risks by severity
- Mitigation recommendations for each
- Timeline impact of addressing issues
- Integration confidence level (High/Medium/Low)
- Rollback readiness assessment

**Integration Confidence Factors**:
- Confidence in preserving existing functionality
- Rollback procedure completeness
- Monitoring coverage for integration points
- Support team readiness
- Regression testing coverage

### 5. Dependency Sequencing Validation

A core feature ensuring work is properly ordered:

**Validation Checks**:

**Functional Dependencies**:
- Features depending on others sequenced correctly
- Shared components built before their use
- User flows follow logical progression
- Authentication features precede protected features
- [[BROWNFIELD]] Existing functionality preserved throughout

**Technical Dependencies**:
- Lower-level services built before higher-level ones
- Libraries and utilities created before their use
- Data models defined before operations on them
- API endpoints defined before client consumption
- [[BROWNFIELD]] Integration points tested at each step

**Cross-Epic Dependencies**:
- Later epics build upon earlier epic functionality
- No epic requires functionality from later epics
- Infrastructure from early epics utilized consistently
- Incremental value delivery maintained
- [[BROWNFIELD]] Each epic maintains system integrity

**Sequencing Rules**:
- Infrastructure before features that use it
- Database setup before data operations
- API framework before endpoints
- Authentication before protected routes
- Testing framework before tests
- Shared components before consuming features

**Detection**:
- Identifies circular dependencies
- Flags out-of-order tasks
- Highlights missing prerequisites
- Validates logical flow

**Output**:
- Dependency violations section in validation report
- Recommended sequencing corrections
- Critical path identification

### 6. MVP Scope Guardian

The PO agent acts as guardian of MVP scope, preventing scope creep:

**Scope Validation**:
- All core goals from PRD addressed
- Features directly support MVP goals
- No extraneous features beyond MVP scope
- Critical features prioritized appropriately
- [[BROWNFIELD]] Enhancement complexity justified

**Scope Creep Detection**:
- Features not tied to core goals flagged
- Gold-plating identified (over-engineering)
- Nice-to-haves masquerading as must-haves
- Unnecessary complexity in solutions

**User Journey Completeness**:
- All critical user journeys fully implemented
- Edge cases and error scenarios addressed
- User experience considerations included
- [[UI/UX]] Accessibility requirements incorporated
- [[BROWNFIELD]] Existing workflows preserved or improved

**Technical Requirements Alignment**:
- All technical constraints from PRD addressed
- Non-functional requirements incorporated
- Architecture decisions align with constraints
- Performance considerations addressed
- [[BROWNFIELD]] Compatibility requirements met

**Output in Validation Report**:
- MVP Completeness section
- Scope creep identified features
- Missing essential functionality
- True MVP vs over-engineering analysis
- Recommendations for scope refinement

### 7. Process Stewardship & Template Compliance

The PO agent ensures rigorous adherence to BMad processes and templates:

**Template Validation**:
- All required template sections present
- No template placeholders unfilled ({{variable}}, _TBD_)
- Section structure follows template exactly
- Agent permission boundaries respected
- Formatting conventions followed

**Process Adherence**:
- Checklists executed systematically
- Workflows followed in correct sequence
- Quality gates enforced at proper points
- Agent handoffs follow defined patterns
- State transitions properly managed

**Agent Permission Enforcement**:
- Validates only designated agents edit specific sections
- Story sections:
  - scrum-master: Status, Story, AC, Tasks, Dev Notes
  - dev-agent: Dev Agent Record sections
  - qa-agent: QA Results section
- Flags violations of edit permissions

**Documentation Standards**:
- Markdown formatting compliance
- Consistent terminology usage
- Cross-reference accuracy
- Code block formatting
- Diagram syntax validation

### 8. Evidence-Based Validation

The PO agent grounds all validation in concrete evidence:

**Validation Approach**:
- **Deep Analysis**: Thoroughly analyze each item against documentation
- **Evidence-Based**: Cite specific sections or code when validating
- **Critical Thinking**: Question assumptions and identify gaps
- **Risk Assessment**: Consider what could go wrong with each decision

**Citation Requirements**:
- Every finding references specific artifact sections
- Claims supported by quotes from source documents
- File paths and line numbers provided when relevant
- Version information included for accuracy

**Confidence Levels**:
- **High**: Clear evidence in documentation
- **Medium**: Implied or partial evidence
- **Low**: Assumption or insufficient evidence
- **None**: No evidence found (flagged for attention)

**Output Format**:
- Findings include evidence citations
- Recommendations reference specific sections
- Issues quote problematic text
- Suggestions provide concrete examples

---

## 9. Advanced Features

### Embedded LLM Guidance Prompts

Both checklists contain embedded LLM guidance that directs the PO agent's thinking:

**Purpose**: Provide contextual guidance for deeper analysis at each validation step

**Format**: `[[LLM: guidance text]]` embedded in checklist sections

**Examples**:

From `po-master-checklist.md`:
```
[[LLM: INITIALIZATION INSTRUCTIONS - PO MASTER CHECKLIST
...
VALIDATION APPROACH:
1. Deep Analysis - Thoroughly analyze each item against documentation
2. Evidence-Based - Cite specific sections or code when validating
3. Critical Thinking - Question assumptions and identify gaps
4. Risk Assessment - Consider what could go wrong with each decision
...]]
```

From `change-checklist.md`:
```
[[LLM: Start by fully understanding what went wrong and why.
Don't jump to solutions yet. Ask probing questions:
- What exactly happened that triggered this review?
- Is this a one-time issue or symptomatic of a larger problem?
- Could this have been anticipated earlier?
- What assumptions were incorrect?
Be specific and factual, not blame-oriented.]]
```

**Guidance Themes**:
- **Infrastructure First**: "Infrastructure must exist before use"
- **External Dependencies**: "Often block progress - handle early"
- **MVP Focus**: "MVP means MINIMUM viable product"
- **Brownfield Risks**: "Think pessimistically about what could break"
- **Change Handling**: "Changes are opportunities to improve, not failures"

**Impact**: Guides the agent to think systematically and deeply about each validation aspect

### Configuration-Driven Behavior

The PO agent adapts its behavior based on `core-config.yaml`:

**Configuration Keys Used**:

```yaml
markdownExploder: true/false
  # Controls document sharding method
  # true: Use @kayvan/markdown-tree-parser automatic sharding
  # false: Use manual LLM-driven sharding

qa:
  qaLocation: docs/qa
  # Location for QA artifacts

prd:
  prdFile: docs/prd.md
  prdVersion: v4
  prdSharded: true/false
  prdShardedLocation: docs/prd
  epicFilePattern: epic-{n}*.md
  # PRD location and sharding status

architecture:
  architectureFile: docs/architecture.md
  architectureVersion: v4
  architectureSharded: true/false
  architectureShardedLocation: docs/architecture
  # Architecture location and sharding status

devStoryLocation: docs/stories
  # Story file location for validation
```

**Adaptive Behaviors**:
- **Document Location**: Finds PRD/Architecture based on config paths
- **Sharding Strategy**: Automatic vs manual based on markdownExploder
- **Story Location**: Validates stories in configured location
- **Epic Pattern**: Uses configured pattern to find epic files
- **Version Awareness**: Handles v4+ sharded vs monolithic documents differently

### Integration with markdown-tree-parser

The PO agent integrates with external tool for optimal document sharding:

**Tool**: `@kayvan/markdown-tree-parser` (npm package)
**Command**: `md-tree explode {source} {destination}`

**Installation**:
```bash
npm install -g @kayvan/markdown-tree-parser
```

**Benefits**:
- Fast, reliable, thoroughly tested
- Handles edge cases automatically (code blocks with ## inside)
- Consistent heading level adjustment
- Proper markdown preservation
- Production-quality output

**Fallback**: Manual sharding via LLM if tool not available or markdownExploder=false

**Configuration Check**:
- Reads `markdownExploder` setting from core-config.yaml
- Attempts tool usage if true
- Falls back gracefully if tool not found
- Provides clear installation instructions if needed

---

## 10. Workflow Coordination

### Planning Phase Gate

The PO agent acts as the gatekeeper between planning and development phases:

**Phase Transition**: Planning ‚Üí Development

**Gate Mechanism**: Master Checklist Validation

**Prerequisites for Gate**:
1. PRD complete and validated (by PM)
2. Architecture complete and validated (by Architect)
3. Frontend Spec complete (if UI project, by UX Expert)
4. All planning artifacts sharded (by PO)
5. Master checklist validation passes (by PO)

**Gate Criteria**:
- All 10 validation categories evaluated
- Critical blocking issues resolved
- Implementation readiness sufficient
- Dependencies properly sequenced
- MVP scope clearly defined

**Gate Outcomes**:
- **APPROVED**: Open gate, proceed to story drafting (SM Agent)
- **CONDITIONAL**: Address specific issues then proceed
- **REJECTED**: Close gate, return to planning (PM/Architect)

**Impact**: Ensures development doesn't begin until planning is solid, preventing costly rework

### Story Approval Gate

The PO agent gates individual story implementation:

**Phase Transition**: Story Draft ‚Üí Story Implementation

**Gate Mechanism**: Story Draft Validation

**Prerequisites for Gate**:
1. Story drafted by SM Agent
2. Parent epic available
3. Architecture documents available
4. Story template compliance

**Gate Criteria** (10-step validation):
- Template completeness
- File structure clarity
- UI/Frontend completeness (if applicable)
- Acceptance criteria satisfaction
- Testing instructions
- Security considerations (if applicable)
- Task sequencing
- Anti-hallucination verification ‚úì
- Implementation readiness
- Self-contained context

**Gate Outcomes**:
- **GO**: Story ready for Dev Agent implementation
- **NO-GO**: Story requires fixes, return to SM

**Impact**: Ensures Dev Agent has complete, accurate context for implementation

### Change Management Workflow

The PO agent orchestrates structured change response:

**Trigger**: Significant change identified (pivot, tech issue, new requirement, failed story)

**Process**: Course Correction Workflow (*correct-course)

**Phases**:
1. **Diagnosis**: Understand trigger and context
2. **Impact Analysis**: Epic and artifact impacts
3. **Option Evaluation**: Direct adjustment, rollback, or re-scope
4. **Proposal Creation**: Sprint Change Proposal with specific edits
5. **Decision**: User approval and handoff determination

**Handoff Decision Tree**:
- **IF** minor adjustments ‚Üí Implement directly, continue development
- **IF** story-level changes ‚Üí Hand off to SM for backlog updates
- **IF** epic-level changes ‚Üí Hand off to PO/SM for reorganization
- **IF** architecture changes ‚Üí Hand off to Architect for replan
- **IF** PRD-level changes ‚Üí Hand off to PM for PRD revision
- **IF** fundamental replan needed ‚Üí Hand off to PM + Architect

**Impact**: Provides structured, systematic response to changes, minimizing disruption

---

## 11. Relationship to Other Agents

### PO vs PM (Product Manager)

**PM Role**: Create product requirements, define MVP, structure epics
**PO Role**: Validate requirements, ensure implementation readiness, manage backlog

**Collaboration Pattern**:
- PM creates PRD ‚Üí PO validates PRD (master checklist)
- PO identifies issues ‚Üí PM revises PRD
- PM structures epics ‚Üí PO shards epics for development
- Change requires PRD replan ‚Üí PO hands back to PM

**Key Difference**: PM is creator, PO is validator and steward

### PO vs SM (Scrum Master)

**SM Role**: Draft individual stories from epics, provide implementation context
**PO Role**: Validate stories for implementation readiness, ensure quality

**Collaboration Pattern**:
- PO provides sharded epics ‚Üí SM drafts stories
- SM drafts story ‚Üí PO validates story
- PO identifies story issues ‚Üí SM revises story
- Story approved ‚Üí SM hands off to Dev

**Key Difference**: SM is story creator, PO is story validator

### PO vs Architect

**Architect Role**: Design system architecture, technology choices, technical specifications
**PO Role**: Validate architecture completeness, dependency sequencing, brownfield risk assessment

**Collaboration Pattern**:
- Architect creates architecture ‚Üí PO validates architecture (master checklist)
- PO identifies gaps ‚Üí Architect revises architecture
- PO shards architecture ‚Üí SM uses for story context
- Change requires architecture replan ‚Üí PO hands back to Architect

**Key Difference**: Architect designs, PO validates and assesses risk

### PO vs Dev (Developer)

**Dev Role**: Implement stories, write code, execute tasks
**PO Role**: Validate stories before implementation, ensure Dev has complete context

**Collaboration Pattern**:
- PO validates story (GO decision) ‚Üí Dev implements story
- PO anti-hallucination check ‚Üí Prevents Dev from inventing details
- Dev requests clarification ‚Üí PO may validate additional context

**Key Difference**: PO ensures readiness, Dev executes implementation

### PO vs QA (Quality Assurance)

**QA Role**: Test implemented stories, gate decisions, comprehensive review
**PO Role**: Validate story drafts before implementation

**Relationship**: Sequential but non-interacting
- PO validates story draft (before implementation)
- Dev implements story
- QA validates implementation (after implementation)

**Key Difference**: PO validates plans, QA validates execution

---

## 12. Critical Success Factors

### 1. Meticulous Attention to Detail

The PO agent must be **extremely thorough** in validation:
- Check every template section for completeness
- Validate every placeholder is filled
- Verify every cross-reference is accurate
- Confirm every dependency is properly sequenced
- Trace every technical claim to source documents

**Why Critical**: Small gaps in planning cascade into large problems during development

### 2. Anti-Hallucination Vigilance

The PO agent must **ruthlessly verify** all technical claims:
- Every library mentioned must be in architecture
- Every API endpoint must be defined in architecture
- Every database schema must be documented
- Every file path must align with source tree
- Every pattern must be specified in architecture

**Why Critical**: Prevents implementation based on assumptions, reduces rework dramatically

### 3. Brownfield Risk Awareness

For brownfield projects, the PO agent must **think pessimistically**:
- Assume changes could break existing functionality
- Require explicit rollback procedures for every change
- Validate compatibility at every integration point
- Ensure monitoring covers new components
- Plan for user impact and communication

**Why Critical**: Brownfield changes in production systems have high stakes

### 4. Process Adherence

The PO agent must **rigorously follow processes**:
- Execute checklists systematically, don't skip items
- Follow validation workflows in exact sequence
- Enforce agent permission boundaries
- Maintain template compliance
- Execute quality gates at proper points

**Why Critical**: Process discipline prevents errors and ensures consistency

### 5. User Collaboration

The PO agent must **actively engage users**:
- Present findings clearly for decision-making
- Seek explicit approval at critical checkpoints
- Offer mode choices (Interactive vs YOLO)
- Explain rationale for recommendations
- Escalate appropriately when blocked

**Why Critical**: PO is steward, not dictator - users make final decisions

---

## 13. Limitations and Constraints

### 1. Read-Only on Planning Artifacts

**Limitation**: PO cannot directly edit PRD, Architecture, or Frontend Spec
**Reason**: These artifacts are owned by PM, Architect, and UX Expert respectively
**Workaround**: PO provides validation reports with specific recommendations; original authors implement changes

### 2. No Code Execution

**Limitation**: PO cannot execute tests or verify code correctness
**Reason**: PO operates at documentation/planning level, not implementation level
**Scope**: PO validates that testing plans exist and are comprehensive, but QA validates actual implementation

### 3. Dependent on Configuration Accuracy

**Limitation**: PO relies on `core-config.yaml` being accurate
**Risk**: If config paths are wrong, PO may not find required documents
**Mitigation**: PO should validate config paths at workflow start, alert if files not found

### 4. Manual Sharding Limitations

**Limitation**: Manual sharding (when markdownExploder=false) can be error-prone
**Risk**: May struggle with complex nested structures or edge cases
**Mitigation**: Prefer automatic sharding with markdown-tree-parser when possible

### 5. Cannot Force Compliance

**Limitation**: PO can recommend but not force other agents to follow processes
**Reason**: PO is steward and advisor, not enforcer
**Reality**: If SM creates non-compliant story, PO can only flag it and recommend fixes

---

## 14. Best Practices

### For Using the PO Agent

1. **Run Master Checklist Before Story Drafting**
   - Don't start development until planning validates
   - Address all critical issues before proceeding
   - Use APPROVED status as gate to next phase

2. **Validate Every Story Before Implementation**
   - Use `*validate-story-draft` on every story
   - Require GO decision before Dev begins
   - Fix NO-GO issues immediately

3. **Shard Documents After Completion**
   - Wait until PRD/Architecture are finalized and validated
   - Use automatic sharding (markdownExploder=true) when possible
   - Verify sharding completeness before SM begins story drafting

4. **Use Interactive Mode for Learning**
   - First-time validations: Use Interactive mode
   - Complex projects: Use Interactive mode for depth
   - Experienced teams: Use YOLO mode for efficiency

5. **Engage PO Early for Course Corrections**
   - Don't wait until problems compound
   - Use `*correct-course` at first sign of significant change
   - Follow Sprint Change Proposal recommendations

6. **Respect the Anti-Hallucination Check**
   - If PO flags unverifiable claims, take seriously
   - Trace back to source documents
   - Update architecture if needed, don't bypass validation

### For PO Agent Behavior

1. **Be Evidence-Based**
   - Cite specific sections when validating
   - Quote problematic text in findings
   - Provide concrete examples in recommendations

2. **Think About Downstream Impact**
   - How will this gap affect Dev Agent?
   - What problems will this dependency create?
   - How will this impact QA testing?

3. **Communicate Clearly**
   - Use structured reports (Executive Summary ‚Üí Details ‚Üí Recommendations)
   - Categorize issues (Critical vs Should-Fix vs Nice-to-Have)
   - Provide actionable recommendations, not just criticisms

4. **Know When to Escalate**
   - Minor issues: Recommend fixes
   - Major issues: Flag as blockers
   - Fundamental issues: Escalate to PM/Architect for replan

5. **Maintain Process Rigor**
   - Don't skip checklist items for efficiency
   - Follow workflows in exact sequence
   - Enforce template compliance strictly

---

## 15. Summary

The PO agent (Sarah) serves as the **quality gatekeeper and process steward** in the BMad framework. Operating between planning and development phases, Sarah ensures all artifacts are comprehensive, consistent, and ready for implementation before development begins.

**Core Responsibilities**:
- Validate planning artifacts via comprehensive master checklist (10 categories, 200+ items)
- Validate story drafts via 10-step validation process with anti-hallucination checks
- Shard large planning documents into development-ready file structures
- Navigate course corrections via structured change management process
- Guard MVP scope and prevent scope creep
- Ensure dependency sequencing is logical and safe
- Assess brownfield integration risks and rollback readiness

**Key Strengths**:
- Meticulous detail orientation preventing downstream errors
- Adaptive validation (Greenfield vs Brownfield, UI vs Backend)
- Anti-hallucination verification ensuring source traceability
- Evidence-based validation with concrete citations
- Process adherence and template compliance enforcement
- Dual-mode execution (Interactive for depth, YOLO for speed)

**Critical Workflows**:
1. **Master Checklist Validation**: Comprehensive planning validation before story drafting
2. **Story Draft Validation**: Pre-implementation readiness verification with GO/NO-GO decision
3. **Document Sharding**: Splitting PRD/Architecture into development-ready structures
4. **Course Correction**: Structured change navigation with Sprint Change Proposals

**Integration Role**:
- **Gates Planning ‚Üí Development**: Master checklist validation
- **Gates Story Draft ‚Üí Implementation**: Story validation
- **Feedback Loop**: Validation reports back to PM, Architect, UX Expert, SM
- **Change Management**: Coordinates response to pivots and issues

**Unique Features**:
- Anti-hallucination verification (Step 8 of story validation)
- Adaptive validation (automatically adjusts for project type)
- Embedded LLM guidance prompts (in checklists)
- Configuration-driven behavior (core-config.yaml)
- Integration with markdown-tree-parser (automatic sharding)
- Comprehensive brownfield risk assessment
- MVP scope guardian

The PO agent is **essential for quality assurance** in the BMad workflow, preventing the common pitfall of "rushing into development with incomplete planning." By rigorously validating artifacts, enforcing processes, and ensuring implementation readiness, Sarah protects development teams from costly rework and ensures project success.

---

**Document Version**: 1.0
**Created**: 2025-10-14
**Author**: Claude Code (AI Agent)
**Analysis Source**: BMad Core v4 Framework

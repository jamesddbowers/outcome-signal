# Story 1.1: Initialize Turborepo Monorepo Structure

**Status:** Approved

---

## Story

**As a** developer,
**I want** a Turborepo monorepo with shared configs,
**so that** we can share code between frontend and backend efficiently.

---

## Acceptance Criteria

1. Root `package.json` with Turborepo configuration
2. Apps: `apps/web` (Next.js with App Router - includes frontend and API Routes in `app/api/`)
3. Packages: `packages/ui`, `packages/types`, `packages/config`
4. Shared TypeScript config (`tsconfig.json` base)
5. Shared ESLint and Prettier configs
6. Turbo pipeline defined for `dev`, `build`, `lint`, `test`

---

## Tasks / Subtasks

- [ ] **Task 1: Initialize pnpm workspace and root configuration** (AC: 1)
  - [ ] Create root `package.json` with workspace configuration
  - [ ] Create `pnpm-workspace.yaml` defining workspace packages
  - [ ] Install Turborepo as dev dependency
  - [ ] Configure `turbo.json` with pipeline definitions for `dev`, `build`, `lint`, `test`

- [ ] **Task 2: Create monorepo directory structure** (AC: 2, 3)
  - [ ] Create `apps/web` directory for Next.js application (will include App Router and API Routes)
  - [ ] Create `packages/ui` directory for shared UI components
  - [ ] Create `packages/types` directory for shared TypeScript types
  - [ ] Create `packages/config` directory for shared configurations

- [ ] **Task 3: Configure shared TypeScript base configuration** (AC: 4)
  - [ ] Create root `tsconfig.json` with strict mode enabled per coding standards
  - [ ] Include TypeScript compiler options: `strict`, `noUnusedLocals`, `noUnusedParameters`, `noImplicitReturns`, `noFallthroughCasesInSwitch`
  - [ ] Configure path aliases (`@/` for internal imports)
  - [ ] Create workspace-specific `tsconfig.json` files extending the base config

- [ ] **Task 4: Configure shared ESLint and Prettier** (AC: 5)
  - [ ] Create `packages/config/eslint` with base ESLint configuration
  - [ ] Create `packages/config/prettier` with Prettier configuration
  - [ ] Install necessary ESLint plugins and parsers in config package
  - [ ] Configure ESLint to work with TypeScript strict mode

- [ ] **Task 5: Set up placeholder package.json files** (AC: 2, 3)
  - [ ] Create `apps/web/package.json` with Next.js placeholder dependencies
  - [ ] Create `packages/ui/package.json` for UI components
  - [ ] Create `packages/types/package.json` for shared types
  - [ ] Create `packages/config/package.json` for configs

- [ ] **Task 6: Verify Turborepo pipeline execution** (AC: 6)
  - [ ] Test `pnpm dev` runs development pipeline
  - [ ] Test `pnpm build` runs build pipeline
  - [ ] Test `pnpm lint` runs linting pipeline
  - [ ] Test `pnpm test` runs test pipeline
  - [ ] Verify turbo caching is working for build outputs

- [ ] **Task 7: Write unit tests for configuration validation**
  - [ ] Test TypeScript configuration extends correctly
  - [ ] Test ESLint configuration loads without errors
  - [ ] Test Prettier configuration is valid
  - [ ] Verify workspace packages are properly linked

---

## Dev Notes

### Previous Story Insights
No previous story exists. This is the foundational story for the entire project.

---

### Architecture Context

**Monorepo Strategy:**
[Source: [architecture/2-high-level-architecture.md#23-repository-structure](docs/architecture/2-high-level-architecture.md#23-repository-structure)]

The project uses **Turborepo** for monorepo management with the following structure:

```
outcomesignal/
├── apps/
│   └── web/                    # Next.js 14 full-stack app (TypeScript)
│       ├── app/                # Next.js App Router
│       │   ├── (auth)/         # Auth pages (login, signup)
│       │   ├── (dashboard)/    # Dashboard pages
│       │   └── api/            # API Routes (TypeScript serverless functions)
│       ├── components/         # React components
│       └── lib/                # Utilities, SDK clients
├── packages/
│   ├── ui/                     # shadcn/ui components (shared)
│   ├── types/                  # Shared TypeScript types (Supabase-generated)
│   ├── shared/                 # Constants, utilities
│   ├── google-adk/             # ADK agent definitions (Python - deployed separately)
│   └── config/                 # ESLint, TypeScript configs
├── infrastructure/             # Terraform for GCP
├── docs/                       # PRD, Architecture, specs
├── vercel.json                 # Vercel deployment config
├── turbo.json                  # Turborepo configuration
├── package.json                # Root workspace
└── pnpm-workspace.yaml         # pnpm workspace definition
```

**Architectural Decision - Next.js API Routes:** This project uses **Next.js API Routes** (TypeScript) as the unified backend API strategy, located at `apps/web/app/api/`. There is no separate `apps/api` directory. This architectural decision enables single-language development (TypeScript), unified deployment via Vercel, and zero cold-start performance for API endpoints.

---

### Package Management
[Source: [architecture/3-tech-stack.md#32-package-management-strategy](docs/architecture/3-tech-stack.md#32-package-management-strategy)]

- **Package Manager:** pnpm version 8.x
- **Rationale:** 3x faster than npm, single package manager for entire TypeScript application
- **Workspace Files:** `pnpm-workspace.yaml` and root `package.json`
- **Python ADK:** Separate pip/requirements.txt for `/packages/google-adk/` (not part of pnpm workspace)

---

### Tech Stack
[Source: [architecture/3-tech-stack.md#31-technology-stack-table](docs/architecture/3-tech-stack.md#31-technology-stack-table)]

- **Monorepo:** Turborepo (latest version)
- **Package Manager:** pnpm 8.x
- **Language:** TypeScript 5.3+
- **Build Tool:** Turbo (Turborepo) for incremental builds with parallel execution

---

### TypeScript Configuration Requirements
[Source: [architecture/15-coding-standards.md#151-typescript-standards](docs/architecture/15-coding-standards.md#151-typescript-standards)]

**Required tsconfig.json settings (Strict Mode):**

```json
{
  "compilerOptions": {
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noImplicitReturns": true,
    "noFallthroughCasesInSwitch": true
  }
}
```

**Type Safety Rules:**
- Explicit return types required for functions
- NO use of `any` type - use `unknown` with type guards instead
- Path aliases configured with `@/` for internal imports

---

### File Naming Conventions
[Source: [architecture/15-coding-standards.md#152-file-naming-conventions](docs/architecture/15-coding-standards.md#152-file-naming-conventions)]

- Components: `PascalCase.tsx`
- Utilities: `kebab-case.ts`
- Hooks: `useHookName.ts`
- Constants: `SCREAMING_SNAKE_CASE.ts`

---

### Turborepo Pipeline Configuration
[Source: [architecture/3-tech-stack.md#31-technology-stack-table](docs/architecture/3-tech-stack.md#31-technology-stack-table)]

The `turbo.json` file must define pipelines for:
- `dev` - Development server
- `build` - Production build with incremental builds
- `lint` - Linting via ESLint
- `test` - Test execution via Vitest

Turbo provides parallel execution and incremental builds for faster performance.

---

### Project Structure Notes

**PO Clarification Complete:** The Product Owner has confirmed that this project uses **Next.js API Routes** (TypeScript) as specified in the architecture document. AC #2 has been updated to reflect this architectural decision. No separate `apps/api` directory is required.

---

## Testing

### Testing Standards
[Source: [architecture/14-testing-strategy.md](docs/architecture/14-testing-strategy.md)]

**Testing Framework:** Vitest (Jest-compatible, faster test execution)

**Test File Location:**
- Co-located with source files or in `__tests__` directories
- Naming pattern: `*.test.ts` or `*.spec.ts`

**Unit Testing Requirements:**
- Target: >80% coverage for configuration files
- Use Vitest for all unit tests
- Test configuration validation (TypeScript, ESLint, Prettier)
- Verify workspace linking and package resolution

**Testing Approach for This Story:**
- Validate TypeScript configuration extends correctly across packages
- Test ESLint and Prettier configurations load without errors
- Verify Turborepo pipeline commands execute successfully
- Test workspace packages are properly linked via pnpm

**API Route Testing (Future Stories):**
[Source: [architecture/14-testing-strategy.md#143-api-route-testing](docs/architecture/14-testing-strategy.md#143-api-route-testing)]

```typescript
describe('POST /api/initiatives', () => {
  it('creates initiative successfully', async () => {
    vi.mocked(auth).mockReturnValue({ userId: 'user-123' });
    const request = new Request('http://localhost/api/initiatives', {
      method: 'POST',
      body: JSON.stringify({ title: 'Test' }),
    });
    const response = await POST(request);
    expect(response.status).toBe(201);
  });
});
```

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-16 | 1.0 | Initial story draft created | Bob (Scrum Master) |
| 2025-10-16 | 1.1 | Updated AC #2 to reflect Next.js API Routes architecture (removed apps/api FastAPI placeholder). Updated Tasks 2 and 5 accordingly. Status changed to Approved. | Sarah (Product Owner) |

---

## Dev Agent Record

### Agent Model Used
_To be populated by Dev Agent during implementation_

### Debug Log References
_To be populated by Dev Agent during implementation_

### Completion Notes List
_To be populated by Dev Agent during implementation_

### File List
_To be populated by Dev Agent during implementation_

---

## QA Results
_To be populated by QA Agent after story completion_
